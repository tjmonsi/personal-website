---
title: Infrastructure Specifications
version: 1.1
date_created: 2026-02-17
last_updated: 2026-02-17
owner: TJ Monserrat
tags: [infrastructure, gcp, cloud-run, firebase, firestore]
---

## Infrastructure Specifications

### Google Cloud Project

- **Project**: *To be created / named*
- **Primary Region**: `asia-southeast1`
- **Billing**: *Budget to be determined*

---

### Components

#### INFRA-001: Firebase Hosting

**Purpose**: Serve the Nuxt 4 SPA static assets (JS, CSS, images) globally via CDN.

**Configuration**:

- Hosting target: Static assets generated by Nuxt 4 build
- Custom domain: `tjmonserrat.com`
- SSL/TLS: Managed by Firebase (automatic)
- Cache headers:
  - HTML files: `Cache-Control: no-cache` (always revalidate)
  - JS/CSS/assets with hash: `Cache-Control: public, max-age=31536000, immutable`
  - Images: `Cache-Control: public, max-age=86400`
- Firebase Functions handles SPA serving (all non-asset routes serve the SPA shell)

---

#### INFRA-002: Firebase Functions

**Purpose**: Serve the Nuxt 4 SPA shell. When Nuxt 4 is deployed in SPA mode on Firebase Hosting, Firebase Functions is required to serve the SPA while Firebase Hosting serves the static JS/CSS assets.

**Reference**: https://nuxt.com/deploy/firebase

**Configuration**:

- Function runtime: Node.js (as required by Nuxt/Nitro)
- Region: `asia-southeast1` (same as Cloud Run for consistency)
- Purpose: Serve the SPA `index.html` shell for all client-side routes
- Memory: 256 MB (minimal, only serving static HTML)
- Max instances: Auto-scaled by Firebase

---

#### INFRA-003: Google Cloud Run

**Purpose**: Host the Go backend API.

**Configuration**:

| Setting              | Value                           |
| -------------------- | ------------------------------- |
| Container runtime    | Go binary in minimal Docker image |
| Region               | `asia-southeast1`               |
| Min instances        | 0 (scale to zero)               |
| Max instances        | *TBD based on budget*           |
| CPU                  | 1 vCPU (initial)                |
| Memory               | 256 MB (initial)                |
| Concurrency          | 80 (default)                    |
| Request timeout      | 30 seconds                      |
| Startup CPU boost    | Enabled                         |
| Ingress              | Internal + Cloud Load Balancing |

**Docker Image**:

```dockerfile
# Multi-stage build
FROM golang:1.23-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o server .

FROM gcr.io/distroless/static-debian12
COPY --from=builder /app/server /server
EXPOSE 8080
ENTRYPOINT ["/server"]
```

**Health Check**: `GET /health` (returns `200` with `{"status": "ok"}`)

---

#### INFRA-004: Google Cloud Load Balancer

**Purpose**: Route traffic, SSL termination, and integration with Cloud Armor.

**Configuration**:

- Type: External Application Load Balancer (Global)
- Backend services:
  - Firebase Hosting (frontend)
  - Cloud Run (backend API)
- SSL Certificate: Google-managed
- URL Map routing:
  - `api.tjmonserrat.com/*` → Cloud Run backend
  - `tjmonserrat.com/*` → Firebase Hosting + Functions
- Subdomain routing is used to separate frontend and backend traffic.

---

#### INFRA-005: Google Cloud Armor

**Purpose**: WAF and DDoS protection.

**Policies**:

| Rule Priority | Description                              | Action    |
| ------------- | ---------------------------------------- | --------- |
| 1000          | Block known malicious IP ranges          | Deny      |
| 2000          | Rate limiting (per IP)                   | Throttle  |
| 3000          | Block SQL injection patterns             | Deny      |
| 4000          | Block XSS patterns                       | Deny      |
| 5000          | Block path traversal attempts            | Deny      |
| 9999          | Default allow                            | Allow     |

**Rate Limiting at Cloud Armor level**:

- Threshold: 120 requests per minute per IP (2x the application-level limit, as a coarse first line of defense)
- Action: HTTP `429` response
- Note: Application-level rate limiting (in Go) provides finer-grained control. Cloud Armor rate limiting serves as a first line of defense.

---

#### INFRA-006: Database

**Technology**: Firestore Enterprise in MongoDB compatibility mode

**References**:
- Firestore Enterprise: https://firebase.google.com/docs/firestore/enterprise/overview-enterprise-edition-modes
- MongoDB Compatibility Mode: https://firebase.google.com/docs/firestore/enterprise/mongodb-compatibility-overview

| Setting          | Value                              |
| ---------------- | ---------------------------------- |
| Mode             | MongoDB compatibility              |
| Region           | `asia-southeast1`                  |
| Driver           | MongoDB Go driver (standard wire protocol) |
| Security         | Backend-only access (no direct client access) |
| Network access   | Private endpoint or IP allowlist from Cloud Run |
| Backup           | Enabled (managed by Firestore Enterprise) |

---

#### INFRA-007: Google Cloud Logging & Monitoring

**Purpose**: Centralized observability.

**Configuration**:

- **Structured logging** from Cloud Run (JSON format)
- **Log sinks**: Route error logs to a dedicated log bucket with 90-day retention
- **Alerts**:
  - Error rate > 1% of requests over 5 minutes
  - Latency P95 > 2 seconds over 5 minutes
  - Cloud Run instance memory > 80%
  - Any masked 500 error logged
- **Dashboards**: Request rate, latency, error rate, Cloud Run instance count

---

### CI/CD Pipeline

**Tool**: GitHub Actions (assumed, given `.github/` directory exists)

**Pipeline stages**:

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│   Lint   │───▶│   Test   │───▶│  Build   │───▶│  Deploy  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
```

| Stage   | Frontend                        | Backend                        |
| ------- | ------------------------------- | ------------------------------ |
| Lint    | ESLint, Stylelint               | golangci-lint                  |
| Test    | Vitest (unit), Playwright (E2E) | `go test`                      |
| Build   | `nuxt generate`                 | Docker build                   |
| Deploy  | Firebase deploy                 | Cloud Run deploy               |

**Branch strategy**:
- `main` → Production
- `staging` → Staging environment
- Feature branches → PR preview (optional)

---

### Network Diagram

```
                    Internet
                       │
                       ▼
              ┌─────────────────┐
              │   Cloud DNS     │
              │ tjmonserrat.com │
              │ api.tjmonserrat │
              │     .com        │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │  Cloud Armor    │
              │  (WAF / DDoS)   │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │  Cloud Load     │
              │  Balancer (L7)  │
              └───┬─────────┬───┘
                  │         │
        ┌─────────┘         └─────────┐
        ▼                             ▼
┌───────────────┐           ┌───────────────┐
│   Firebase    │           │   Cloud Run   │
│   Hosting +   │           │   (Go API)    │
│   Functions   │           │   asia-se1    │
│   (SPA)       │           │   0-N inst.   │
└───────────────┘           └───────┬───────┘
                                    │
                                    ▼
                            ┌───────────────┐
                            │   Firestore   │
                            │   Enterprise  │
                            │   (MongoDB    │
                            │   compat)     │
                            │   asia-se1    │
                            └───────────────┘
```
