---
title: System Overview
version: 2.0
date_created: 2026-02-17
last_updated: 2026-02-17
owner: TJ Monserrat
tags: [architecture, system-overview, infrastructure]
---

## System Overview

### Purpose

A personal website for TJ Monserrat serving as a professional online presence with a technical blog, opinion blog, social links, and curated external content references.

### Technology Stack

| Layer          | Technology                             | Hosting                                  |
| -------------- | -------------------------------------- | ---------------------------------------- |
| Frontend       | Nuxt 4 / Vue 3 / Vite (SPA mode)      | Firebase Hosting + Firebase Functions    |
| Backend API    | Go                                     | Google Cloud Run (asia-southeast1)       |
| Sitemap Gen    | Node.js (Cloud Functions Gen 2)        | Google Cloud Functions (asia-southeast1) |
| Log Processing | Node.js (Cloud Functions Gen 2)        | Google Cloud Functions (asia-southeast1) |
| Database       | Firestore Enterprise (MongoDB compatibility mode) | Google Cloud (asia-southeast1)  |
| Vector Search  | Firestore Native Mode                  | Google Cloud (asia-southeast1)           |
| Embedding      | Gemini API — `gemini-embedding-001`    | Google Cloud (asia-southeast1)           |
| CDN / WAF      | Google Cloud Load Balancer + Cloud Armor | Google Cloud                           |
| Networking     | VPC with Private Google Access (Production only) | Google Cloud (asia-southeast1)           |
| Scheduling     | Google Cloud Scheduler                 | Google Cloud (asia-southeast1)           |
| Observability  | Google Cloud Logging + Cloud Monitoring + BigQuery | Google Cloud                |
| Analytics      | Looker Studio                          | Google Cloud (owner-operated)            |

### Definitions

| Term                            | Definition |
| ------------------------------- | ---------- |
| Firestore Enterprise            | Google Cloud's enterprise-grade document database. See: https://firebase.google.com/docs/firestore/enterprise/overview-enterprise-edition-modes |
| MongoDB Compatibility Mode      | Firestore Enterprise mode that exposes a MongoDB-compatible wire protocol, allowing use of standard MongoDB drivers and tools. See: https://firebase.google.com/docs/firestore/enterprise/mongodb-compatibility-overview |
| SPA                             | Single Page Application — client-side rendered web application |
| Cloud Run                       | Google Cloud's serverless container hosting platform |
| Cloud Armor                     | Google Cloud's WAF and DDoS protection service |
| Firebase Functions              | Cloud Functions integrated with Firebase, used here to serve the Nuxt 4 SPA |
| Cloud Functions Gen 2           | Google Cloud's second-generation serverless functions platform, built on Cloud Run infrastructure. Used here for internal sitemap generation and Cloud Armor log processing. |
| Log Sink                        | A Cloud Logging export mechanism that routes matching log entries to a destination (e.g., Pub/Sub, Cloud Function) for further processing. Used here to route Cloud Armor rate-limit events to a Cloud Function. |
| Cloud Armor Adaptive Protection | A Cloud Armor feature that uses machine learning to detect and mitigate L7 DDoS attacks automatically, providing escalating protection without manual rule configuration. |
| VPC                             | Virtual Private Cloud — isolated network environment for Google Cloud resources. Used in Production only; Development does not use a VPC to reduce cost. |
| Cloud Scheduler                 | Google Cloud's managed cron job service for scheduling periodic tasks |
| BigQuery                        | Google Cloud's serverless data warehouse for SQL-based log analytics. Used here to store exported Cloud Logging logs for long-term querying and Looker Studio integration. |
| Looker Studio                   | Google Cloud's business intelligence and data visualization tool. Used here as an owner-operated analytics dashboard connected to BigQuery via a service account. |
| Log Sink (BigQuery)             | A Cloud Logging export mechanism that routes matching log entries to a BigQuery dataset for long-term storage and SQL querying. Five sinks route logs to dedicated tables. |
| Firestore Native Mode           | Google Cloud Firestore in Native mode. A separate Firestore database used exclusively for vector similarity search. Distinct from Firestore Enterprise (MongoDB compat mode). See: https://firebase.google.com/docs/firestore |
| Vector Embedding                | A fixed-dimension numerical representation of text generated by a machine learning model (Gemini `gemini-embedding-001`), enabling semantic similarity search via cosine distance. Embeddings are generated with `output_dimensionality=768` and L2-normalized before storage. |
| Cosine Distance                 | A distance metric for comparing vector similarity. Range 0 (identical) to 2 (opposite). Lower values indicate higher semantic similarity. Firestore Native uses cosine distance for vector search. |
| UUID v5                         | A deterministic UUID generated from a namespace UUID and a name string using SHA-1 hashing. The same inputs always produce the same UUID. Used here to derive cache document IDs from search query strings. |
| Gemini API                      | Google's Gemini API for AI model access. Used here to call the `gemini-embedding-001` model for generating text embeddings via the `embedContent` endpoint. Auth via API key stored in Secret Manager. See: https://ai.google.dev/gemini-api/docs/embeddings |

### High-Level Architecture

```
┌─────────────────────────────────────────────────────────┐
│                      End Users                          │
└──────────────────────┬──────────────────────────────────┘
                       │
                       ▼
              ┌─────────────────┐
              │   Cloud DNS     │
              │  tjmonsi.com    │
              │ api.tjmonsi.com │
              └────────┬────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────┐
│           Google Cloud Load Balancer                    │
│              + Cloud Armor (WAF)                        │
└──────────┬──────────────────────────────┬───────────────┘
           │                              │
           ▼                              ▼
┌─────────────────────┐  ┌──── VPC (Production only) ──────┐
│  Firebase Hosting   │  │                                 │
│  + Functions        │  │  ┌────────────────────────────┐ │
│  (Nuxt 4 SPA)       │  │  │   Google Cloud Run          │ │
│                     │  │  │   (Go API)                 │ │
│  tjmonsi.com        │  │  │   api.tjmonsi.com          │ │
│                     │  │  │                            │ │
│  Rewrites:          │  │  │  GET  /                    │ │
│  /sitemap.xml ──────│──│──│▶ GET  /sitemap.xml          │ │
│                     │  │  │  GET  /technical            │ │
│  Pages:             │  │  │  GET  /technical/{slug}.md  │ │
│  /                  │  │  │  GET  /blog                 │ │
│  /technical         │  │  │  GET  /blog/{slug}.md       │ │
│  /technical/:s.md   │  │  │  GET  /socials              │ │
│  /blog              │  │  │  GET  /others               │ │
│  /blog/:slug.md     │  │  │  GET  /categories           │ │
│  /socials           │  │  │  GET  /robots.txt           │ │
│  /others            │  │  │  GET  /health (internal)    │ │
│  /privacy           │  │  │  POST /t                    │ │
└─────────────────────┘  │  └─────────────┬──────────────┘ │
                         │                │                 │
                         │                ▼                 │
                         │  ┌────────────────────────────┐  │
                         │  │  Firestore Enterprise      │  │
                         │  │  (MongoDB compat mode)     │  │
                         │  │  asia-southeast1           │  │
                         │  └────────────┬───────────────┘  │
                         │               ▲                  │
                         │  ┌────────────┴───────────────┐  │
Cloud Scheduler ────────▶│  │  Cloud Function (Gen 2)    │  │
                         │  │  Sitemap Generation       │  │
                         │  └────────────────────────────┘  │
                         │                                   │
                         │  ┌────────────────────────────┐  │
Cloud Armor Log Sink ───▶│  │  Cloud Function (Gen 2)    │  │
                         │  │  Rate Limit Log Processing │  │
                         │  │  (Node.js) → writes to DM-009 │
                         │  └────────────────────────────┘  │
                         └──────────────────────────────────┘

              ┌──────────────────────────────────┐
              │     Firestore Native Mode        │
              │     (Vector Search)              │
              │     asia-southeast1              │
              └──────────────────────────────────┘
                         ▲                ▲
              Cloud Run queries     Embedding Sync
              for nearest vectors   Cloud Function writes
                                        │
              ┌──────────────────────────────────┐
              │     Gemini API                   │
              │     gemini-embedding-001          │
              └──────────────────────────────────┘
                         ▲
              Cloud Run + Embedding Sync
              call for embeddings

              Cloud Logging (receives all service logs)
                           │
                           ▼ (5 Log Sinks → INFRA-010)
              ┌──────────────────────────────────┐
              │      BigQuery (website_logs)     │
              └────────────────┬─────────────────┘
                           │
                           ▼
              ┌──────────────────────────────────┐
              │   Looker Studio (Analytics)      │
              └──────────────────────────────────┘
```

### Key Architectural Decisions

| ID     | Decision                                      | Rationale                                                                 |
| ------ | --------------------------------------------- | ------------------------------------------------------------------------- |
| AD-001 | Nuxt 4 in SPA mode (no SSR)                   | Simpler deployment; Firebase Functions serves the SPA shell while Firebase Hosting serves static JS/CSS assets. See: https://nuxt.com/deploy/firebase |
| AD-002 | Go for backend API                             | Performance, low memory footprint on Cloud Run, strong typing             |
| AD-003 | Cloud Run behind Load Balancer + Cloud Armor   | Managed scaling, DDoS protection, WAF rules                              |
| AD-004 | GET-only API with single POST exception        | Read-only public surface reduces attack vectors. `POST /t` is the sole exception for visitor tracking and error reporting. |
| AD-005 | Fixed page size of 10 items                    | Simplifies API, predictable performance, no user-controlled query abuse   |
| AD-006 | Firestore Enterprise with MongoDB compatibility | Uses Google-native infrastructure with MongoDB wire protocol, enabling standard MongoDB Go driver and query language |
| AD-007 | API served on subdomain (`api.tjmonsi.com`) | Clean separation of frontend and backend, independent scaling and caching policies |
| AD-008 | Content managed via separate Git repository    | Articles and content are maintained in a dedicated repo; a CI/CD pipeline pushes content to the database on merge. Keeps the public API read-only. |
| AD-009 | Frontend SPA with offline reading support      | Not installable as PWA, but supports offline reading via smart prefetching and manual article saving in the browser |
| AD-010 | Free-form categories derived from articles     | Categories are stored in a dedicated collection and synced from article metadata. Frontend caches categories in sessionStorage for 24 hours. |
| AD-011 | VPC with Private Google Access (Production only) | In Production, Cloud Run and Cloud Functions connect to Firestore via VPC, restricting egress to Google Cloud APIs only. No NAT router needed — minimizes cost and attack surface. The Development environment does NOT use a VPC to reduce cost; services connect to Google Cloud APIs directly. |
| AD-012 | Cloud Function for sitemap generation            | Sitemap generation runs as a separate internal Cloud Function (Gen 2, Node.js), triggered by Cloud Scheduler every 6 hours. Keeps the API backend focused on serving requests. |
| AD-013 | Frontend routes include `.md` extension          | Article URLs use `.md` extension (e.g., `/technical/slug.md`) to present the appearance of accessing a markdown file, while content is dynamically fetched from the backend API. |
| AD-014 | Cloud Function for offense tracking from Cloud Armor logs | A log sink routes Cloud Armor rate-limit (429) events to a Cloud Function, which writes offense records to the `rate_limit_offenders` Firestore collection (DM-009). This bridges the gap between Cloud Armor's request-level rate limiting and the application's progressive banning logic. |
| AD-015 | Cloud Armor Adaptive Protection enabled           | Cloud Armor's adaptive protection provides automatic, ML-based escalating DDoS mitigation. This complements application-level progressive banning with infrastructure-level protection that requires no manual rule updates. |
| AD-016 | BigQuery log sinks for analytics                  | All Cloud Logging logs are exported to a BigQuery dataset (`website_logs`) via 5 dedicated log sinks — enabling SQL-based analytics, up to 2 years of retention, and Looker Studio dashboards without impacting operational logging. IP addresses are truncated before logging to ensure anonymization in BigQuery. |
| AD-017 | Looker Studio for analytics dashboards            | Owner-operated Looker Studio dashboards connect to BigQuery via a service account with read-only access, providing visitor analytics (unique visitors, page views, referrer sources, etc.) without third-party analytics tools. |
| AD-018 | Dual-database: Firestore Enterprise + Firestore Native | Firestore Enterprise (MongoDB compat) stores all application data. Firestore Native stores vector embeddings for semantic article search. Two databases in the same project, each optimized for its purpose. The Go API uses the MongoDB Go driver for Enterprise and the Firestore Go SDK for Native. |
| AD-019 | Deterministic embedding cache with UUID v5         | Search query embeddings are cached in Firestore Enterprise (`embedding_cache` collection, DM-011) using UUID v5 of the lowercased query as the document ID. No search strings are stored — only the deterministic UUID and the embedding vector. No cache expiration. The UUID v5 namespace is the standard URL namespace (`6ba7b811-9dad-11d1-80b4-00c04fd430c8`) with name = lowercased search text. |
| AD-020 | Cosine distance threshold for vector search        | Search results with cosine distance > 0.35 (cosine similarity < 0.65) are excluded. This threshold balances recall and precision for semantic article search. Configurable per deployment. Reference: https://ai.google.dev/gemini-api/docs/embeddings |
| AD-021 | Vector search replaces text search for `q` parameter | When the `q` query parameter is present, the system uses Gemini embedding + Firestore Native vector similarity search instead of MongoDB text indexes. Without `q`, queries use Firestore Enterprise directly. Filtering (category, tags, date range) is always applied in Firestore Enterprise. |

### Deployment Topology

- **Region (Firestore)**: `asia-southeast1`
- **Region (Cloud Run)**: `asia-southeast1`
- **Domain**: `tjmonsi.com` (frontend), `api.tjmonsi.com` (backend API)
- **VPC** (Production only): `personal-website-vpc` in `asia-southeast1` with minimum subnets for Cloud Run and Cloud Functions connectors. Private Google Access enabled; no NAT router. The Development environment does NOT use a VPC to reduce cost.
- **Cloud Run**: Min instances = 0 (scale to zero), Max instances = TBD based on budget
- **Cloud Functions**: Sitemap generation function (Gen 2, Node.js) running internally in `asia-southeast1`
- **Cloud Functions**: Log processing function (Gen 2, Node.js) triggered by Cloud Armor log sink in `asia-southeast1`
- **BigQuery**: Dataset `website_logs` in `asia-southeast1` with 5 tables fed by Cloud Logging log sinks (see INFRA-010)
- **Looker Studio**: Owner-operated analytics dashboards connected to BigQuery via service account (see INFRA-011)
- **Firebase Hosting**: Global CDN distribution for static assets
- **Firebase Functions**: Serves the Nuxt 4 SPA shell
- **Database**: Same region as Cloud Run (`asia-southeast1`) for low latency
- **Firestore Native**: Vector search database in `asia-southeast1` with vector indexes on embedding fields (768 dimensions, cosine distance)
- **Gemini API**: `gemini-embedding-001` model for generating text embeddings (API key stored in Secret Manager)

### Content Management

Content (articles, front page, social links, external references) is managed through a **separate Git repository**. A CI/CD pipeline in that repository processes markdown files and pushes structured content to the Firestore Enterprise database on merge. The public-facing API remains read-only (`GET`-only, except `POST /t` for tracking).

### Environments

| Environment | Purpose                                                   | Database          |
| ----------- | --------------------------------------------------------- | ----------------- |
| Development | Local development, testing, and pre-production validation | Firestore Emulator / Local MongoDB |
| Production  | Live website                                              | Production Firestore Enterprise |

> **Note**: Only two environments are maintained. The Development environment doubles as a staging/pre-production environment since the owner can deploy immediately. No separate staging GCP project is provisioned.
